#!/bin/bash

# Function to disable a package in the config
disable_package() {
	sed -i "s+${1}=y+# ${1} is not set+g" "$FREETZ_SSL_HOME_PATH/.config"
}

# Function to remove specific lines from the config
remove_lines() {
	grep -v "$1" "$FREETZ_SSL_HOME_PATH/.config" > "$FREETZ_SSL_HOME_PATH/tempdatei" && mv "$FREETZ_SSL_HOME_PATH/tempdatei" "$FREETZ_SSL_HOME_PATH/.config"
}

# List of packages to disable
packages=(
	"FREETZ_PACKAGE_RRDSTATS"
	"FREETZ_PACKAGE_RRDTOOL"
	"FREETZ_LIB_libz"
	"FREETZ_LIB_libfreetype"
	"FREETZ_LIB_libart_lgpl_2"
	"FREETZ_LIB_libpng12"
	"FREETZ_LIB_librrd"
	"FREETZ_LIB_libglib_2"
	"FREETZ_BUSYBOX___V127_START_STOP_DAEMON"
	"FREETZ_BUSYBOX___V136_START_STOP_DAEMON"
	"FREETZ_REMOVE_AVMCOUNTERD"
	"FREETZ_PACKAGE_DEJAVU_FONTS_TTF"
	"FREETZ_PACKAGE_DEJAVU_FONTS_TTF_DejaVuSansMono"
	"FREETZ_PACKAGE_FONTCONFIG"
	"FREETZ_LIB_libfribidi"
	"FREETZ_LIB_libgio_2"
	"FREETZ_LIB_libgobject_2"
	"FREETZ_LIB_libgmodule_2"
	"FREETZ_LIB_libcairo"
	"FREETZ_LIB_libfontconfig"
	"FREETZ_LIB_libharfbuzz"
	"FREETZ_LIB_libpango_1"
	"FREETZ_LIB_libpangoft2_1"
	"FREETZ_LIB_libpangocairo_1"
	"FREETZ_LIB_libpixman_1"
	"FREETZ_LIB_libxml2"
	"FREETZ_LIB_libffi"
	"FREETZ_STDCXXLIB_FORCE_GNULIBSTDCXX"
	"FREETZ_STDCXXLIB_USE_GNULIBSTDCXX"
	"FREETZ_LIB_libpng16"
	"FREETZ_LIB_libpcre"
	"FREETZ_PACKAGE_CA_BUNDLE"
	"FREETZ_PACKAGE_DVBTUNE"
	"FREETZ_PACKAGE_WGET"
	"FREETZ_LIB_libcrypto_WITH_EC"
	"FREETZ_PACKAGE_DIGITEMP"
)

# Process the packages
for package in "${packages[@]}"; do
	disable_package "$package"
done

# Lines to remove
lines_to_remove=(
	"FREETZ_PACKAGE_RRDTOOL_VERSION_ABANDON"
	"FREETZ_PACKAGE_RRDTOOL_VERSION_CURRENT"
	"FREETZ_PACKAGE_RRDSTATS_CABLEMODEM"
	"PACKAGE_RRDSTATS_SEGMENTLOAD"
	"FREETZ_PACKAGE_RRDSTATS_STORAGE"
	"FREETZ_PACKAGE_RRDSTATS_NETWORK"
	"FREETZ_PACKAGE_RRDSTATS_DIGITEMP"
	"FREETZ_PACKAGE_RRDSTATS_SMARTHOME"
	"FREETZ_BUSYBOX_FEATURE_START_STOP_DAEMON_FANCY"
	"FREETZ_BUSYBOX___V127_FEATURE_START_STOP_DAEMON_FANCY"
	"FREETZ_BUSYBOX___V136_FEATURE_START_STOP_DAEMON_FANCY"
	"FREETZ_BUSYBOX___V127_FEATURE_START_STOP_DAEMON_LONG_OPTIONS"
	"FREETZ_BUSYBOX___V136_FEATURE_START_STOP_DAEMON_LONG_OPTIONS"
	"FREETZ_PACKAGE_RRDSTATS_TEMPERATURE_SENSOR"
	"FREETZ_BUSYBOX_START_STOP_DAEMON"
	"FREETZ_PACKAGE_DVBSNOOP"
	"FREETZ_PACKAGE_WGET_WITH_SSL"
	"FREETZ_PACKAGE_WGET_OPENSSL"
	"FREETZ_PACKAGE_WGET_GNUTLS"
	"FREETZ_PACKAGE_WGET_CA_BUNDLE"
	"FREETZ_PACKAGE_WGET_STATIC"
	"FREETZ_PACKAGE_DIGITEMP_DS2490"
	"FREETZ_PACKAGE_DIGITEMP_DS9097U"
	"FREETZ_PACKAGE_DIGITEMP_DS9097"
)

# Remove the specified lines
for line in "${lines_to_remove[@]}"; do
	remove_lines "$line"
done

# Update comments for specific variables
sed -i "s+rrdtool_1_2_${FUD_COMMENT_RRD}+${FUD_COMMENT_RRD}+g" "$FREETZ_SSL_HOME_PATH/.config" 2>/dev/null
sed -i "s+rrdtool_1_8_${FUD_COMMENT_RRD}+${FUD_COMMENT_RRD}+g" "$FREETZ_SSL_HOME_PATH/.config" 2>/dev/null
